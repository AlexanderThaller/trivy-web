<!DOCTYPE html>
<html lang="en">

  <head>
    <title>Trivy Web Scanner</title>

    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width"
    >

    <link
      rel="stylesheet"
      type="text/css"
      href="/css/main.css"
    />

    <script
      async
      src="/js/htmx/2.0.0/htmx.min.js.gz"
    ></script>
  </head>

  <body>
    <h1>Trivy Image Scanner</h1>

    <form
      id="form"
      onsubmit="updateDivs(); return false;"
    >
      <fieldset>
        <h2>Image</h2>
        <p>
          <label for="imagename">Image Name</label>
          <input
            id="image"
            input="text"
            name="imagename"
          />
        </p>

        <h2>Credentials</h2>
        <p>
          <label for="username">Username</label>
          <input
            input="text"
            name="username"
          />
        </p>

        <p>
          <label for="password">Password</label>
          <input
            input="text"
            type="password"
            name="password"
          />
        </p>

        <h2>Cosign</h2>
        <p>
          <label for="cosign_key">Cosign Key</label>
          <input
            input="text"
            name="cosign_key"
          />
        </p>
      </fieldset>

      <p>
        <button>Submit</button>
      </p>
    </form>

    <hr>

    <div id="image_information"></div>
    <div id="scan_information"></div>

    <script>
      function updateDivs() {
        var form = document.getElementById('form');
        var formData = new FormData(form);

        var imagename = formData.get('imagename');
        var username = formData.get('username');
        var password = formData.get('password');
        var cosign_key = formData.get('cosign_key');

        document.getElementById('image_information').innerHTML = `<img src="/img/bars.svg">`;
        document.getElementById('scan_information').innerHTML = `<img src="/img/bars.svg">`;

        htmx.ajax('POST', '/image', {
          target: '#image_information',
          swap: 'innerHTML',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          values: {
            imagename: imagename,
            cosign_key: cosign_key
          }
        });

        htmx.ajax('POST', '/trivy', {
          target: '#scan_information',
          swap: 'innerHTML',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          values: {
            imagename: imagename,
            username: username,
            password: password,
          }
        });
      }
    </script>
  </body>

</html>